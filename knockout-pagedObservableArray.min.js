/*! ko.pagedObservableArray 2013-07-16 */
!function($,ko){"use strict";ko.pagedObservableArray=function(options){if(!options)throw"Options not specified";if(!options.loadPage)throw"loadPage not specified on options";options.schema=options.schema||{data:"Data",count:"Count"};var self=this,_allData=ko.observableArray(options.data||[]),_pageSize=ko.observable(options.pageSize||10),_pageIndex=ko.observable(1),_totalCount=ko.observable(_allData().length),_pageCount=ko.computed(function(){var count=0;return count=_totalCount()>0?Math.ceil(ko.utils.unwrapObservable(_totalCount)/ko.utils.unwrapObservable(_pageSize)):Math.ceil(_allData().length/ko.utils.unwrapObservable(_pageSize))}),_pageRange=ko.computed(function(){for(var pages=[],cnt=_pageCount(),i=1;cnt>=i;i++)pages.push(i);return pages}),_pagedData=ko.computed(function(){var pageSize=_pageSize(),pageIndex=_pageIndex(),startIndex=pageSize*pageIndex,endIndex=pageSize*(pageIndex+1);return options.serverPaging||!options.aggregateResults&&!options.data?_allData():_allData().slice(startIndex,endIndex)},self),_map=options.map,_loading=ko.observable(!1),_loadPage=function(){return $.Deferred(function(def){var deferred,paramOptions={pageSize:_pageSize(),pageIndex:_pageIndex()};_loading(!0),options.parameterMap&&(paramOptions=options.parameterMap(paramOptions)),deferred=options.loadPage(paramOptions),$.when(deferred).then(function(data,status){var tmpArray=[];data&&data[options.schema.data]?(_map?tmpArray=_map(data[options.schema.data]):tmpArray.push.apply(tmpArray,data[options.schema.data]),options.aggregateResults?ko.utils.arrayPushAll(_allData,tmpArray):_allData(tmpArray),_allData.valueHasMutated(),_totalCount(data[options.schema.count]||0),def.resolve(_totalCount())):def.reject(status)}).always(function(){_loading(!1)})}).promise()},_refresh=function(){_loadPage()},_nextPage=function(){_pageIndex()<_pageCount()&&(_pageIndex(_pageIndex()+1),_loadPage())},_moveToPage=function(index){_pageIndex()!==index&&(_pageIndex(index),_loadPage())},_previousPage=function(){_pageIndex()>1&&(_pageIndex(_pageIndex()-1),_loadPage())};options.autoLoad&&_loadPage(),ko.computed(function(){_pageSize(),_pageIndex(1),_loadPage()}).extend({throttle:1}),self.allData=_allData,self.pagedData=_pagedData,self.load=_loadPage,self.pageRange=_pageRange,self.pageSize=_pageSize,self.pageIndex=_pageIndex,self.pageCount=_pageCount,self.nextPage=_nextPage,self.moveToPage=_moveToPage,self.previousPage=_previousPage,self.refresh=_refresh,self.totalCount=_totalCount,self.loading=_loading,self.refresh=_refresh}}($,ko);